# Overview: Debug Tool Parameter Conversion (JSON in XML)

## 1. Goal

The primary goal of this conversion is to **improve the robustness and reliability of debug tool calls generated by Large Language Models (LLMs)**. By changing how parameters are passed to specific debug operations (e.g., `debug_launch`, `debug_set_breakpoint`), we aim to reduce failures caused by malformed or truncated LLM outputs.

## 2. Current Method Description

Currently, parameters for debug operations are passed as individual XML child tags nested within the main operation tag. This method requires the LLM to generate multiple, correctly structured XML elements for the parameters.

## 3. Proposed Method

The proposed method is to pass all parameters for a specific debug operation as a **single JSON object**. This JSON object will be provided as the text content of the main operation tag. The outer operation tag (e.g., `<debug_launch>`) remains XML, which is used for tool dispatch by the system.

**Example of the Proposed Format (represented as a string):**
"<debug_launch>{\"program\": \"src/app/main.py\", \"mode\": \"pytest\", \"args\": [\"--verbose\"]}</debug_launch>"

## 4. Rationale for Change

LLMs generally exhibit higher reliability in generating a single, well-formed JSON object compared to a series of correctly nested XML tags. This change leverages that strength:
*   **Reduced Truncation Errors:** A single JSON blob is less likely to be truncated in a way that breaks parsing.
*   **Simpler Structure for LLM:** Generating one JSON object is a more straightforward task for an LLM.
*   **Improved Handling of Complex Data:** JSON naturally supports arrays and nested objects, making it cleaner for parameters like lists of arguments (`args`) or environment variable maps (`env`).
*   **Easier Debugging of Tool Calls:** Malformed JSON is often easier to diagnose.

## 5. Major Implementation Steps

1.  **Modify Core Parsing Logic (`debugTool.ts`):**
    *   Update [`debugTool.ts`](src/core/tools/debugTool.ts:1) to extract the text content of the specific debug operation tag.
    *   Parse this text content as a JSON string (`JSON.parse()`).
    *   Use the resulting JavaScript object as the `operationArgs` for validation and execution.
2.  **Adapt Validation (`debugToolValidation.ts`):**
    *   Ensure that `validateOperationArgs` in [`debugToolValidation.ts`](src/core/tools/debugToolValidation.ts:1) correctly handles the `operationArgs` object when it's directly from parsed JSON.
3.  **Update Documentation & Examples:**
    *   Revise all documentation, including general debug tool descriptions (e.g., in [`src/core/prompts/tools/debug.ts`](src/core/prompts/tools/debug.ts:1)) and any specific operation examples, to reflect the new JSON-based parameter format. Ensure all examples strictly use the new format and are presented as quoted strings.
4.  **Update LLM Prompt Engineering:**
    *   Modify all system prompts, instructions, and few-shot examples provided to the LLM to instruct it to use the new JSON format for debug tool parameters.
5.  **Thorough Testing:**
    *   Conduct comprehensive testing across all debug operations with various parameter combinations, including valid, invalid, and malformed JSON inputs.
6.  **Backward Compatibility Strategy (Optional):**
    *   Evaluate the need for backward compatibility with the old XML child tag format.
    *   If required, implement logic to detect the parameter format and parse accordingly during a transition period.